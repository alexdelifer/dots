# Variables
set $mod Mod1

set $up k
set $down j
set $left h
set $right l

# Display Outputs
# Laptop

set $laptop eDP-1
set $usb-c  DP-1
set $hdmi   HDMI-A-2
#bindswitch --reload lid:on output $laptop disable
#bindswitch --reload lid:off output $laptop enable

#output $laptop     pos 0    0 res 1920x1080 
#output $hdmi	   pos 1920 0 res 1920x1080
#output $usb-c      pos 3840 0 res 1920x1080

# Wallpaper

#output "*" bg /home/alex/Pictures/Hysteresis.png fill

#seat seat0 xcursor_theme Openzone_Black_Slim 48

# Keyboard
input type:keyboard {
    xkb_layout us
    #xkb_options "caps:escape"
}

# Thinkpad Touchpad
input "2:7:SynPS/2_Synaptics_TouchPad" {
    dwt enabled
    tap disabled
    natural_scroll enabled
    middle_emulation enabled
}

# Thinkpad Touchscreen
input 1386:20915:Wacom_Pen_and_multitouch_sensor_Finger map_to_output eDP-1
input 1386:20915:Wacom_Pen_and_multitouch_sensor_Pen    map_to_output eDP-1


set $WS1 "1:term"
set $WS2 "2:web"
set $WS3 "3:code"
set $WS4 "4:work"
set $WS5 "5:music"
set $WS6 "6:docs"
set $WS7 "7:7"
set $WS8 "8:8"
set $WS9 "9:9"
set $WS10 "10:10"

# Autostarts
# kill then exec to restart when $mod+Shift+r for reload 
exec_always pkill swayidle;		exec ~/.config/sway/locker -w
exec_always pkill mako;			exec mako
exec_always pkill wayvnc;		exec wayvnc 127.0.0.1
exec_always pkill mpris-proxy;		exec mpris-proxy
exec_always pkill ydotoold;		exec ydotoold
#exec_always pkill waybar; 		exec waybar
exec_always pkill flashfocus;		exec flashfocus
exec_always pkill nm-applet;		exec nm-applet --indicator
exec_always pkill mconnectd;		exec mconnect -d
exec_always pkill blueman-applet;	exec blueman-applet
exec_always pkill kanshi;		exec kanshi
exec_always pkill gammastep;		exec gammastep
#exec_always pkill squeekboard;		exec squeekboard
exec_always pkill signal-daemon;	exec ~/bin/signal-daemon


# Aesthetics
# font pango:Iosevka Nerd Font 14
#font pango:Fira Code Nerd Font Bold 10
font pango: CaskaydiaCove Nerd Font Mono 10
gaps inner 14
gaps outer 0
default_border pixel 4
default_floating_border pixel 4


# class                 border  backgr. text    indicator child_border
client.focused          #c2c3c7 #5f676a #ffffff #ff77a8   #29adff
client.focused_inactive #333333 #5f676a #ffffff #484e50   #5f676a
client.unfocused        #333333 #222222 #888888 #292d2e   #222222
client.urgent           #2f343a #900000 #ffffff #900000   #900000
client.placeholder      #000000 #0c0c0c #ffffff #000000   #0c0c0c
#
client.background       #ffffff

# Keybinds

# crutch aka floating mode 
floating_modifier $mod
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

# Terminal
bindsym $mod+Return exec alacritty
bindsym $mod+Shift+Return exec alacritty -t floaterm -d 80 24
#bindsym $mod+Return exec kitty
#bindsym $mod+Shift+Return exec kitty -T floaterm --class floaterm 

bindsym $mod+Shift+q kill
bindsym $mod+n exec makoctl dismiss
bindsym $mod+Shift+n exec makoctl dismiss -a
bindsym $mod+b exec polybar-msg cmd toggle

# Send Clipboard to Phone
bindsym $mod+Shift+z exec ~/bin/phonesend.sh "$(wl-paste)"
bindsym $mod+z exec ~/bin/open.sh "$(wl-paste)"

# Apps

# Rofi thru Alacritty
for_window [title="swaylauncher"]    floating enable, resize set 800 300

bindsym $mod+Shift+d exec alacritty -t swaylauncher -e \
		bash -c 'compgen -c \
		| grep -v fzf \
		| sort -u \
		| fzf --layout=reverse \
		| xargs -r swaymsg -t command exec'

#bindsym $mod+d exec alacritty -t swaylauncher -e \
#		bash -c 'i3-dmenu-desktop --dmenu=fzf \
#		| xargs -r swaymsg -t command exec'


bindsym $mod+d exec alacritty -t swaylauncher \
		-e "$HOME/.config/sway/sway-launcher-desktop.sh"

#bindsym $mod+d exec rofi -show drun

# Corrupt Lock Screen

bindsym $mod+q exec loginctl lock-session
bindsym $mod+Escape exec loginctl lock-session
bindsym $mod+Shift+Escape exec swaylock -i ~/.wallpaper-lock

# Screenshot to clipboard for wayland
bindsym $mod+p exec grim -g "$(slurp -d)" - | wl-copy
bindsym --release Print exec grim -g "$(slurp)" - | wl-copy

# XF86

# Wob
exec mkfifo $SWAYSOCK.wob && tail -f $SWAYSOCK.wob | wob


bindsym --locked XF86AudioRaiseVolume exec amixer -q set Master 2%+ unmute \
	&& amixer sget Master \
	| grep 'Right:' \
	| awk -F'[][]' '{ print substr($2, 0, length($2)-1) }' \
	> $SWAYSOCK.wob
bindsym --locked XF86AudioLowerVolume exec amixer -q set Master 2%- unmute \
	&& amixer sget Master \
	| grep 'Right:' \
	| awk -F'[][]' '{ print substr($2, 0, length($2)-1) }' \
	> $SWAYSOCK.wob
bindsym --locked XF86AudioMute exec (amixer get Master \
	| grep off > /dev/null \
	&& amixer -q set Master unmute \
	&& amixer sget Master \
	| grep 'Right:' \
	| awk -F'[][]' '{ print substr($2, 0, length($2)-1) }' \
	> $SWAYSOCK.wob) \
	|| (amixer -q set Master mute && echo 0 \
	> $SWAYSOCK.wob)


bindsym --locked XF86MonBrightnessUp exec light -A 5 \
	&& light -G \
	| cut -d'.' -f1 \
	> $SWAYSOCK.wob
bindsym --locked XF86MonBrightnessDown exec light -U 5 \
	&& light -G \
	| cut -d'.' -f1 \
	> $SWAYSOCK.wob


bindsym --locked XF86AudioMicMute exec amixer sset Capture,0 toggle
bindsym --locked XF86AudioPlay exec playerctl play-pause
bindsym --locked XF86AudioNext exec playerctl next
bindsym --locked XF86AudioPrev exec playerctl previous


bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

bindsym $mod+Shift+$left move left 150
bindsym $mod+Shift+$down move down 150
bindsym $mod+Shift+$up move up 150
bindsym $mod+Shift+$right move right 150

bindsym Mod4+$left resize shrink width 10 px or 10 ppt
bindsym Mod4+$down resize grow height 10 px or 10 ppt
bindsym Mod4+$up resize shrink height 10 px or 10 ppt
bindsym Mod4+$right resize grow width 10 px or 10 ppt

bindsym $mod+u split h
bindcode $mod+20 split v

bindsym $mod+v split v
bindcode $mod+Shift+51 split h
bindcode $mod+51 split h

bindsym $mod+f fullscreen toggle
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

bindsym $mod+a focus parent

bindsym $mod+bracketleft workspace prev
bindsym $mod+bracketright workspace next

bindsym $mod+1 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS1
bindsym $mod+2 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS2
bindsym $mod+3 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS3
bindsym $mod+4 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS4
bindsym $mod+5 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS5
bindsym $mod+6 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS6
bindsym $mod+7 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS7
bindsym $mod+8 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS8
bindsym $mod+9 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS9
bindsym $mod+0 exec --no-startup-id ~/.config/i3/switch-workspace.py $WS10

bindsym $mod+Shift+1 move container to workspace $WS1
bindsym $mod+Shift+2 move container to workspace $WS2
bindsym $mod+Shift+3 move container to workspace $WS3
bindsym $mod+Shift+4 move container to workspace $WS4
bindsym $mod+Shift+5 move container to workspace $WS5
bindsym $mod+Shift+6 move container to workspace $WS6
bindsym $mod+Shift+7 move container to workspace $WS7
bindsym $mod+Shift+8 move container to workspace $WS8
bindsym $mod+Shift+9 move container to workspace $WS9
bindsym $mod+Shift+0 move container to workspace $WS10

bindsym $mod+period move scratchpad                                                           
bindsym $mod+comma scratchpad show

bindsym $mod+Shift+c reload
#bindsym $mod+Shift+r restart
bindsym $mod+Shift+r reload
#bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"
bindsym $mod+Shift+e exec swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -b 'Yes, exit sway' 'swaymsg exit'

# Rules
# Floating
for_window [app_id="firefox" title="^Picture-in-Picture$"] \
    floating enable, move position 877 450, sticky enable

for_window [title="floaterm"] resize set 640 480, floating enable

#for_window [instance="termite"] border pixel 3
for_window [class="Clock-applet"] floating enable
for_window [class="Adobe Photoshop CS6"] floating enable
for_window [instance="keybase"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="task_dialog"] floating enable

# Assign workspaces
for_window [class="Firefox"] move container to workspace $WS2
for_window [class="Thunderbird"] move container to workspace $WS4
for_window [class="Evolution"] move container to workspace $WS4
for_window [class="Remmina"] move container to workspace $WS4
for_window [class="Steam"] move container to workspace $WS7
for_window [instance="vmware"] move container to workspace $WS8
for_window [class="Spotify"] move container to workspace $WS5
for_window [class="keepassxc"] move container to workspace $WS9

# Modes
bindsym $mod+Shift+g mode "$mode_gaps"
bindsym $mod+r mode "resize"

# resize window (you can also use the mouse for that)
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        bindsym $left resize shrink width 10 px or 10 ppt
        bindsym $down resize grow height 10 px or 10 ppt
        bindsym $up resize shrink height 10 px or 10 ppt
        bindsym $right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

set $mode_gaps Gaps: (o) outer, (i) inner
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
mode "$mode_gaps" {
        bindsym o      mode "$mode_gaps_outer"
        bindsym i      mode "$mode_gaps_inner"
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

mode "$mode_gaps_inner" {
        bindsym plus  gaps inner current plus 5
        bindsym minus gaps inner current minus 5
        bindsym 0     gaps inner current set 0

        bindsym Shift+plus  gaps inner all plus 5
        bindsym Shift+minus gaps inner all minus 5
        bindsym Shift+0     gaps inner all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}
mode "$mode_gaps_outer" {
        bindsym plus  gaps outer current plus 5
        bindsym minus gaps outer current minus 5
        bindsym 0     gaps outer current set 0

        bindsym Shift+plus  gaps outer all plus 5
        bindsym Shift+minus gaps outer all minus 5
        bindsym Shift+0     gaps outer all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}

bar {
    status_command i3status
    position top
    font pango:CaskaydiaCove Nerd Font Mono

        colors {
        background #000000
        separator #757575
        #                  border             background         text
        #focused_workspace  $bg-color          $bg-color          $text-color
        #inactive_workspace $inactive-bg-color $inactive-bg-color $inactive-text-color
        #urgent_workspace   $urgent-bg-color   $urgent-bg-color   $text-color
    }
}


exec --no-startup-id i3-msg "workspace $WS1"
